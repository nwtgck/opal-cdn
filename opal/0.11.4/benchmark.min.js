Opal.modules.benchmark=function(Opal){function $rb_minus(lhs,rhs){return"number"==typeof lhs&&"number"==typeof rhs?lhs-rhs:lhs["$-"](rhs)}function $rb_plus(lhs,rhs){return"number"==typeof lhs&&"number"==typeof rhs?lhs+rhs:lhs["$+"](rhs)}function $rb_times(lhs,rhs){return"number"==typeof lhs&&"number"==typeof rhs?lhs*rhs:lhs["$*"](rhs)}Opal.top;var $nesting=[],nil=Opal.nil,$module=(Opal.breaker,Opal.slice,Opal.module),$send=Opal.send,$truthy=Opal.truthy,$klass=Opal.klass,$gvars=Opal.gvars;return Opal.add_stubs(["$sync","$sync=","$-","$+","$empty?","$print","$*","$new","$===","$each","$grep","$ljust","$shift","$label","$format","$list","$nil?","$benchmark","$to_proc","$width","$puts","$length","$inject","$measure","$rjust","$map","$start","$tap","$times","$clock_gettime","$utime","$stime","$cutime","$cstime","$module_function","$raise","$to_s","$<","$<<","$attr_reader","$real","$memberwise","$gsub","$dup","$%","$total","$protected","$__send__"]),function($base,$parent_nesting){var TMP_Benchmark_benchmark_1,TMP_Benchmark_bm_3,TMP_Benchmark_bmbm_4,$b,TMP_Benchmark_measure_8,TMP_Benchmark_realtime_9,self=$module($base,"Benchmark"),$nesting=(self.$$proto,[self].concat($parent_nesting));Opal.const_set($nesting[0],"BENCHMARK_VERSION","2002-04-25"),Opal.defn(self,"$benchmark",TMP_Benchmark_benchmark_1=function(caption,label_width,format,$a_rest){var $b,TMP_2,labels,self=this,$iter=TMP_Benchmark_benchmark_1.$$p,$yield=$iter||nil,sync=nil,$writer=nil,report=nil,results=nil;null==caption&&(caption=""),null==label_width&&(label_width=nil),null==format&&(format=nil);var $args_len=arguments.length,$rest_len=$args_len-3;$rest_len<0&&($rest_len=0),labels=new Array($rest_len);for(var $arg_idx=3;$arg_idx<$args_len;$arg_idx++)labels[$arg_idx-3]=arguments[$arg_idx];return $iter&&(TMP_Benchmark_benchmark_1.$$p=null),function(){try{return sync=Opal.const_get_relative($nesting,"STDOUT").$sync(),$writer=[!0],$send(Opal.const_get_relative($nesting,"STDOUT"),"sync=",Opal.to_a($writer)),$writer[$rb_minus($writer.length,1)],label_width=$rb_plus(label_width=$truthy($b=label_width)?$b:0,1),format=$truthy($b=format)?$b:Opal.const_get_relative($nesting,"FORMAT"),$truthy(caption["$empty?"]())||self.$print($rb_plus($rb_times(" ",label_width),caption)),report=Opal.const_get_relative($nesting,"Report").$new(label_width,format),results=Opal.yield1($yield,report),$truthy($b=Opal.const_get_relative($nesting,"Array")["$==="](results))&&$send(results.$grep(Opal.const_get_relative($nesting,"Tms")),"each",[],((TMP_2=function(t){var $a,$c,self=TMP_2.$$s||this;return null==t&&(t=nil),self.$print(($truthy($a=$truthy($c=labels.$shift())?$c:t.$label())?$a:"").$ljust(label_width),t.$format(format))}).$$s=self,TMP_2.$$arity=1,TMP_2)),report.$list()}finally{$truthy(sync["$nil?"]())||($writer=[sync],$send(Opal.const_get_relative($nesting,"STDOUT"),"sync=",Opal.to_a($writer)),$writer[$rb_minus($writer.length,1)])}}()},TMP_Benchmark_benchmark_1.$$arity=-1),Opal.defn(self,"$bm",TMP_Benchmark_bm_3=function(label_width,$a_rest){var labels,$iter=TMP_Benchmark_bm_3.$$p,blk=$iter||nil;null==label_width&&(label_width=0);var $args_len=arguments.length,$rest_len=$args_len-1;$rest_len<0&&($rest_len=0),labels=new Array($rest_len);for(var $arg_idx=1;$arg_idx<$args_len;$arg_idx++)labels[$arg_idx-1]=arguments[$arg_idx];return $iter&&(TMP_Benchmark_bm_3.$$p=null),$send(this,"benchmark",[Opal.const_get_relative($nesting,"CAPTION"),label_width,Opal.const_get_relative($nesting,"FORMAT")].concat(Opal.to_a(labels)),blk.$to_proc())},TMP_Benchmark_bm_3.$$arity=-1),Opal.defn(self,"$bmbm",TMP_Benchmark_bmbm_4=function(width){var TMP_5,TMP_6,self=this,$iter=TMP_Benchmark_bmbm_4.$$p,$yield=$iter||nil,job=nil,sync=nil,$writer=nil,ets=nil;return null==width&&(width=0),$iter&&(TMP_Benchmark_bmbm_4.$$p=null),function(){try{return job=Opal.const_get_relative($nesting,"Job").$new(width),Opal.yield1($yield,job),width=$rb_plus(job.$width(),1),sync=Opal.const_get_relative($nesting,"STDOUT").$sync(),$writer=[!0],$send(Opal.const_get_relative($nesting,"STDOUT"),"sync=",Opal.to_a($writer)),$writer[$rb_minus($writer.length,1)],self.$puts("Rehearsal ".$ljust($rb_plus(width,Opal.const_get_relative($nesting,"CAPTION").$length()),"-")),ets=$send(job.$list(),"inject",[Opal.const_get_relative($nesting,"Tms").$new()],(TMP_5=function(sum,$a){var $a_args,label,item,self=TMP_5.$$s||this,res=nil;return null==$a&&($a=nil),$a=Opal.to_ary($a),null==(label=($a_args=Opal.slice.call($a,0,$a.length)).splice(0,1)[0])&&(label=nil),null==(item=$a_args.splice(0,1)[0])&&(item=nil),null==sum&&(sum=nil),self.$print(label.$ljust(width)),res=$send(Opal.const_get_relative($nesting,"Benchmark"),"measure",[],item.$to_proc()),self.$print(res.$format()),$rb_plus(sum,res)},TMP_5.$$s=self,TMP_5.$$arity=2,TMP_5.$$has_top_level_mlhs_arg=!0,TMP_5)).$format("total: %tsec"),self.$print((" "+ets+"\n\n").$rjust($rb_plus($rb_plus(width,Opal.const_get_relative($nesting,"CAPTION").$length()),2),"-")),self.$print($rb_plus($rb_times(" ",width),Opal.const_get_relative($nesting,"CAPTION"))),$send(job.$list(),"map",[],((TMP_6=function(label,item){var TMP_7,self=TMP_6.$$s||this;return null==label&&(label=nil),null==item&&(item=nil),Opal.const_get_relative($nesting,"GC").$start(),self.$print(label.$ljust(width)),$send($send(Opal.const_get_relative($nesting,"Benchmark"),"measure",[label],item.$to_proc()),"tap",[],((TMP_7=function(res){var self=TMP_7.$$s||this;return null==res&&(res=nil),self.$print(res)}).$$s=self,TMP_7.$$arity=1,TMP_7))}).$$s=self,TMP_6.$$arity=2,TMP_6))}finally{$truthy(sync["$nil?"]())||($writer=[sync],$send(Opal.const_get_relative($nesting,"STDOUT"),"sync=",Opal.to_a($writer)),$writer[$rb_minus($writer.length,1)])}}()},TMP_Benchmark_bmbm_4.$$arity=-1),$truthy(($b=Opal.const_get_relative($nesting,"Process","skip_raise"))&&Opal.const_get_qualified($b,"CLOCK_MONOTONIC","skip_raise")?"constant":nil)?Opal.const_set($nesting[0],"BENCHMARK_CLOCK",Opal.const_get_qualified(Opal.const_get_relative($nesting,"Process"),"CLOCK_MONOTONIC")):Opal.const_set($nesting[0],"BENCHMARK_CLOCK",Opal.const_get_qualified(Opal.const_get_relative($nesting,"Process"),"CLOCK_REALTIME")),Opal.defn(self,"$measure",TMP_Benchmark_measure_8=function(label){var $a,r0,r1,$iter=TMP_Benchmark_measure_8.$$p,$yield=$iter||nil,t0=nil,t1=nil;return null==label&&(label=""),$iter&&(TMP_Benchmark_measure_8.$$p=null),t0=($a=[Opal.const_get_relative($nesting,"Process").$times(),Opal.const_get_relative($nesting,"Process").$clock_gettime(Opal.const_get_relative($nesting,"BENCHMARK_CLOCK"))])[0],r0=$a[1],Opal.yieldX($yield,[]),t1=($a=[Opal.const_get_relative($nesting,"Process").$times(),Opal.const_get_relative($nesting,"Process").$clock_gettime(Opal.const_get_relative($nesting,"BENCHMARK_CLOCK"))])[0],r1=$a[1],Opal.const_get_qualified(Opal.const_get_relative($nesting,"Benchmark"),"Tms").$new($rb_minus(t1.$utime(),t0.$utime()),$rb_minus(t1.$stime(),t0.$stime()),$rb_minus(t1.$cutime(),t0.$cutime()),$rb_minus(t1.$cstime(),t0.$cstime()),$rb_minus(r1,r0),label)},TMP_Benchmark_measure_8.$$arity=-1),Opal.defn(self,"$realtime",TMP_Benchmark_realtime_9=function(){var r0,$iter=TMP_Benchmark_realtime_9.$$p,$yield=$iter||nil;return $iter&&(TMP_Benchmark_realtime_9.$$p=null),r0=Opal.const_get_relative($nesting,"Process").$clock_gettime(Opal.const_get_relative($nesting,"BENCHMARK_CLOCK")),Opal.yieldX($yield,[]),$rb_minus(Opal.const_get_relative($nesting,"Process").$clock_gettime(Opal.const_get_relative($nesting,"BENCHMARK_CLOCK")),r0)},TMP_Benchmark_realtime_9.$$arity=0),self.$module_function("benchmark","measure","realtime","bm","bmbm"),function($base,$super,$parent_nesting){function $Job(){}var TMP_Job_initialize_10,TMP_Job_item_11,self=$Job=$klass($base,null,"Job",$Job),def=self.$$proto,$nesting=[self].concat($parent_nesting);def.width=def.list=nil,Opal.defn(self,"$initialize",TMP_Job_initialize_10=function(width){return this.width=width,this.list=[]},TMP_Job_initialize_10.$$arity=1),Opal.defn(self,"$item",TMP_Job_item_11=function(label){var w,lhs,rhs,$iter=TMP_Job_item_11.$$p,blk=$iter||nil;return null==label&&(label=""),$iter&&(TMP_Job_item_11.$$p=null),blk!==nil||this.$raise(Opal.const_get_relative($nesting,"ArgumentError"),"no block"),w=(label=label.$to_s()).$length(),$truthy((lhs=this.width,rhs=w,"number"==typeof lhs&&"number"==typeof rhs?lhs<rhs:lhs["$<"](rhs)))&&(this.width=w),this.list["$<<"]([label,blk]),this},TMP_Job_item_11.$$arity=-1),Opal.alias(self,"report","item"),self.$attr_reader("list"),self.$attr_reader("width")}($nesting[0],0,$nesting),function($base,$super,$parent_nesting){function $Report(){}var TMP_Report_initialize_12,TMP_Report_item_13,self=$Report=$klass($base,null,"Report",$Report),def=self.$$proto,$nesting=[self].concat($parent_nesting);def.width=def.list=def.format=nil,Opal.defn(self,"$initialize",TMP_Report_initialize_12=function(width,format){var $a;return null==width&&(width=0),null==format&&(format=nil),$a=[width,format,[]],this.width=$a[0],this.format=$a[1],this.list=$a[2],$a},TMP_Report_initialize_12.$$arity=-1),Opal.defn(self,"$item",TMP_Report_item_13=function(label,$a_rest){var format,res,$iter=TMP_Report_item_13.$$p,blk=$iter||nil;null==label&&(label="");var $args_len=arguments.length,$rest_len=$args_len-1;$rest_len<0&&($rest_len=0),format=new Array($rest_len);for(var $arg_idx=1;$arg_idx<$args_len;$arg_idx++)format[$arg_idx-1]=arguments[$arg_idx];return $iter&&(TMP_Report_item_13.$$p=null),this.$print(label.$to_s().$ljust(this.width)),this.list["$<<"](res=$send(Opal.const_get_relative($nesting,"Benchmark"),"measure",[label],blk.$to_proc())),this.$print($send(res,"format",[this.format].concat(Opal.to_a(format)))),res},TMP_Report_item_13.$$arity=-1),Opal.alias(self,"report","item"),self.$attr_reader("list")}($nesting[0],0,$nesting),function($base,$super,$parent_nesting){function $Tms(){}var TMP_Tms_initialize_14,TMP_Tms_add_15,TMP_Tms_add$B_16,TMP_Tms_$_17,TMP_Tms_$_18,TMP_Tms_$_19,TMP_Tms_$_20,TMP_Tms_format_28,TMP_Tms_to_s_29,TMP_Tms_to_a_30,TMP_Tms_memberwise_31,self=$Tms=$klass($base,null,"Tms",$Tms),def=self.$$proto,$nesting=[self].concat($parent_nesting);def.utime=def.stime=def.cutime=def.cstime=def.label=def.real=nil,Opal.const_set($nesting[0],"CAPTION","      user     system      total        real\n"),Opal.const_set($nesting[0],"FORMAT","%10.6u %10.6y %10.6t %10.6r\n"),self.$attr_reader("utime"),self.$attr_reader("stime"),self.$attr_reader("cutime"),self.$attr_reader("cstime"),self.$attr_reader("real"),self.$attr_reader("total"),self.$attr_reader("label"),Opal.defn(self,"$initialize",TMP_Tms_initialize_14=function(utime,stime,cutime,cstime,real,label){var $a;return null==utime&&(utime=0),null==stime&&(stime=0),null==cutime&&(cutime=0),null==cstime&&(cstime=0),null==real&&(real=0),null==label&&(label=nil),$a=[utime,stime,cutime,cstime,real,label.$to_s()],this.utime=$a[0],this.stime=$a[1],this.cutime=$a[2],this.cstime=$a[3],this.real=$a[4],this.label=$a[5],this.total=$rb_plus($rb_plus($rb_plus(this.utime,this.stime),this.cutime),this.cstime)},TMP_Tms_initialize_14.$$arity=-1),Opal.defn(self,"$add",TMP_Tms_add_15=function(){var $iter=TMP_Tms_add_15.$$p,blk=$iter||nil;return $iter&&(TMP_Tms_add_15.$$p=null),$rb_plus(this,$send(Opal.const_get_relative($nesting,"Benchmark"),"measure",[],blk.$to_proc()))},TMP_Tms_add_15.$$arity=0),Opal.defn(self,"$add!",TMP_Tms_add$B_16=function(){var $iter=TMP_Tms_add$B_16.$$p,blk=$iter||nil,t=nil;return $iter&&(TMP_Tms_add$B_16.$$p=null),t=$send(Opal.const_get_relative($nesting,"Benchmark"),"measure",[],blk.$to_proc()),this.utime=$rb_plus(this.$utime(),t.$utime()),this.stime=$rb_plus(this.$stime(),t.$stime()),this.cutime=$rb_plus(this.$cutime(),t.$cutime()),this.cstime=$rb_plus(this.$cstime(),t.$cstime()),this.real=$rb_plus(this.$real(),t.$real()),this},TMP_Tms_add$B_16.$$arity=0),Opal.defn(self,"$+",TMP_Tms_$_17=function(other){return this.$memberwise("+",other)},TMP_Tms_$_17.$$arity=1),Opal.defn(self,"$-",TMP_Tms_$_18=function(other){return this.$memberwise("-",other)},TMP_Tms_$_18.$$arity=1),Opal.defn(self,"$*",TMP_Tms_$_19=function(x){return this.$memberwise("*",x)},TMP_Tms_$_19.$$arity=1),Opal.defn(self,"$/",TMP_Tms_$_20=function(x){return this.$memberwise("/",x)},TMP_Tms_$_20.$$arity=1),Opal.defn(self,"$format",TMP_Tms_format_28=function(format,$a_rest){var $b,TMP_21,TMP_22,TMP_23,TMP_24,TMP_25,TMP_26,TMP_27,args,str=nil;null==format&&(format=nil);var $args_len=arguments.length,$rest_len=$args_len-1;$rest_len<0&&($rest_len=0),args=new Array($rest_len);for(var $arg_idx=1;$arg_idx<$args_len;$arg_idx++)args[$arg_idx-1]=arguments[$arg_idx];return str=$send($send($send($send($send($send($send(($truthy($b=format)?$b:Opal.const_get_relative($nesting,"FORMAT")).$dup(),"gsub",[/(%[-+.\d]*)n/],((TMP_21=function(){var $a,self=TMP_21.$$s||this;return((($a=$gvars["~"])===nil?nil:$a["$[]"](1))+"s")["$%"](self.$label())}).$$s=this,TMP_21.$$arity=0,TMP_21)),"gsub",[/(%[-+.\d]*)u/],((TMP_22=function(){var $a,self=TMP_22.$$s||this;return((($a=$gvars["~"])===nil?nil:$a["$[]"](1))+"f")["$%"](self.$utime())}).$$s=this,TMP_22.$$arity=0,TMP_22)),"gsub",[/(%[-+.\d]*)y/],((TMP_23=function(){var $a,self=TMP_23.$$s||this;return((($a=$gvars["~"])===nil?nil:$a["$[]"](1))+"f")["$%"](self.$stime())}).$$s=this,TMP_23.$$arity=0,TMP_23)),"gsub",[/(%[-+.\d]*)U/],((TMP_24=function(){var $a,self=TMP_24.$$s||this;return((($a=$gvars["~"])===nil?nil:$a["$[]"](1))+"f")["$%"](self.$cutime())}).$$s=this,TMP_24.$$arity=0,TMP_24)),"gsub",[/(%[-+.\d]*)Y/],((TMP_25=function(){var $a,self=TMP_25.$$s||this;return((($a=$gvars["~"])===nil?nil:$a["$[]"](1))+"f")["$%"](self.$cstime())}).$$s=this,TMP_25.$$arity=0,TMP_25)),"gsub",[/(%[-+.\d]*)t/],((TMP_26=function(){var $a,self=TMP_26.$$s||this;return((($a=$gvars["~"])===nil?nil:$a["$[]"](1))+"f")["$%"](self.$total())}).$$s=this,TMP_26.$$arity=0,TMP_26)),"gsub",[/(%[-+.\d]*)r/],((TMP_27=function(){var $a,self=TMP_27.$$s||this;return("("+(($a=$gvars["~"])===nil?nil:$a["$[]"](1))+"f)")["$%"](self.$real())}).$$s=this,TMP_27.$$arity=0,TMP_27)),$truthy(format)?str["$%"](args):str},TMP_Tms_format_28.$$arity=-1),Opal.defn(self,"$to_s",TMP_Tms_to_s_29=function(){return this.$format()},TMP_Tms_to_s_29.$$arity=0),Opal.defn(self,"$to_a",TMP_Tms_to_a_30=function(){return[this.label,this.utime,this.stime,this.cutime,this.cstime,this.real]},TMP_Tms_to_a_30.$$arity=0),self.$protected(),Opal.defn(self,"$memberwise",TMP_Tms_memberwise_31=function(op,x){var self=this,$case=nil;return $case=x,Opal.const_get_qualified(Opal.const_get_relative($nesting,"Benchmark"),"Tms")["$==="]($case)?Opal.const_get_qualified(Opal.const_get_relative($nesting,"Benchmark"),"Tms").$new(self.$utime().$__send__(op,x.$utime()),self.$stime().$__send__(op,x.$stime()),self.$cutime().$__send__(op,x.$cutime()),self.$cstime().$__send__(op,x.$cstime()),self.$real().$__send__(op,x.$real())):Opal.const_get_qualified(Opal.const_get_relative($nesting,"Benchmark"),"Tms").$new(self.$utime().$__send__(op,x),self.$stime().$__send__(op,x),self.$cutime().$__send__(op,x),self.$cstime().$__send__(op,x),self.$real().$__send__(op,x))},TMP_Tms_memberwise_31.$$arity=2)}($nesting[0],0,$nesting),Opal.const_set($nesting[0],"CAPTION",Opal.const_get_qualified(Opal.const_get_qualified(Opal.const_get_relative($nesting,"Benchmark"),"Tms"),"CAPTION")),Opal.const_set($nesting[0],"FORMAT",Opal.const_get_qualified(Opal.const_get_qualified(Opal.const_get_relative($nesting,"Benchmark"),"Tms"),"FORMAT"))}($nesting[0],$nesting)};
